/*! For license information please see index.js.LICENSE.txt */
(()=>{var e=[(e,t,r)=>{var n,o;function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){"use strict";var a={amdO:{},n:function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,{a:t}),t},d:function(e,t){for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}};function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}a.r({});var l=(function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(f.prototype,[{key:"set",value:function(e){}}]),new f);function f(){!function(e){if(!(e instanceof f))throw new TypeError("Cannot call a class as a function")}(this),u(this,"unImmutableData",{equal:function(e,t){return e===t},copy:function(e){return e}}),u(this,"list",{key:"_id",mapSimilarityForDiff:.6})}var c=r(2),s=a.n(c),p=r(3),y=a.n(p),m=(c=r(4),p=a.n(c),function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(d.prototype,[{key:"set",value:function(e,t,r){s().isImmutable(e)&&s().isImmutable(t)?this.cache[s().hash(e)+"_"+s().hash(t)]=r:s().isImmutable(e)&&void 0!==t&&(this.cache[s().hash(e)]=t)}},{key:"get",value:function(e,t){return s().isImmutable(e)&&s().isImmutable(t)?this.cache[s().hash(e)+"_"+s().hash(t)]:s().isImmutable(e)&&void 0===t?this.cache[s().hash(e)]:null}},{key:"size",value:function(){return Object.getOwnPropertyNames(this.cache).length}},{key:"clear",value:function(){this.cache={}}}]),new d);function d(){var e;!function(e){if(!(e instanceof d))throw new TypeError("Cannot call a class as a function")}(this),e={},"cache"in this?Object.defineProperty(this,"cache",{value:e,enumerable:!0,configurable:!0,writable:!0}):this.cache=e}function h(e){return(h="function"==typeof Symbol&&"symbol"==i(Symbol.iterator)?function(e){return i(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":i(e)})(e)}var b=Object.prototype.toString,g=function(e){return"object"===h(e)&&(s().isImmutable(e)||Array.isArray(e)||function(e){if(!e||"object"!==h(e)||"[object Object]"!==b.call(e))return!1;if(null===(e=Object.getPrototypeOf(e)))return!0;for(var t=e,r=Object.getPrototypeOf(e);null!==r;)t=r,r=Object.getPrototypeOf(t);return t===e}(e))};function v(e){return"string"==typeof e||"number"==typeof e||"symbol"===h(e)||"boolean"==typeof e||null==e}function S(e,t){var r=1<arguments.length&&void 0!==t&&t;if(s().isImmutable(e)){if(t=e.toString(),!r)return"Immutable "+t.split(" ")[0];if(0==t.indexOf("Map"))return"object";if(0==t.indexOf("List"))return"array";e=e.toJS()}return y()(e)}p();var j=function(e){return void 0===e};function O(e){var t=0;return g(e)?(e=s().fromJS(e),m.get(e)?m.get(e):(e.map((function(e){t+=O(e)})),t&&m.set(e,t),t)):1}var x=function(e){if(t=e,("object"===("undefined"==typeof HTMLElement?"undefined":h(HTMLElement))?t instanceof HTMLElement:t&&"object"===h(t)&&(1===t.nodeType||9===t.nodeType)&&"string"==typeof t.nodeName)||v(e))return e;if(s().isImmutable(e))return e;var t=s().fromJS(e);return s().isImmutable(t)?t:l.unImmutableData.copy(e)};function L(e){return(L="function"==typeof Symbol&&"symbol"==i(Symbol.iterator)?function(e){return i(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":i(e)})(e)}var I=function(e){return!(!(t=e)||"object"!==L(t)||(t=e,"[object RegExp]"===(e=Object.prototype.toString.call(t))||"[object Date]"===e||t.$$typeof===k));var t},k="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function w(e,t){return!1!==t.clone&&t.isMergeableObject(e)?J(Array.isArray(e)?[]:{},e,t):e}function A(e){return Object.keys(e).concat((t=e,Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter((function(e){return t.propertyIsEnumerable(e)})):[]));var t}function M(e,t){try{return t in e}catch(e){return}}function J(e,t,r){return(r=r||{}).isMergeableObject=r.isMergeableObject||I,e===t?e:"object"!==L(e)||null===e?t:(o=t,a=(n=e)||{},(i=r).isMergeableObject(n)&&A(n).forEach((function(e){a[e]=w(n[e],i)})),A(o).forEach((function(e){var t,r;(!M(t=n,r=e)||Object.hasOwnProperty.call(t,r)&&Object.propertyIsEnumerable.call(t,r))&&(M(n,e)&&i.isMergeableObject(o[e])?a[e]=(t=e,((r=i).customMerge&&"function"==typeof(t=r.customMerge(t))?t:J)(n[e],o[e],i)):a[e]=w(o[e],i))})),a);var n,o,i,a}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function E(e){return(E="function"==typeof Symbol&&"symbol"==i(Symbol.iterator)?function(e){return i(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":i(e)})(e)}function T(e){return(T="function"==typeof Symbol&&"symbol"==i(Symbol.iterator)?function(e){return i(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":i(e)})(e)}function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function C(e,t,r){return t&&_(e.prototype,t),r&&_(e,r),e}function q(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var z=(C(F,[{key:"push",value:function(e){switch(e.operation){case"add":case"update":case"del":return void(this.mergeLog[e.operation]=function(e,t,r){var n=0<arguments.length&&void 0!==e?e:{},o=(t=1<arguments.length?t:void 0,2<arguments.length?r:["add","update","del"]);if("object"!=E(n))throw new Error("请输入Object");return(t=Array.isArray(t)?t:[t]).map((function(e){if(o.includes(e.operation))for(var t,r=e.path,i=(r=s().isImmutable(r)?r.toArray():r,e.type),a=(i=s().isImmutable(i)?i.toArray():i,n),u=0;u<r.length;u++){if(t=r[u],"del"==e.operation&&1==r.length){a[t]=null;break}if("del"==e.operation&&u==r.length-2){void 0!==a[t]?Array.isArray(a[t])?a[t].push(r[r.length-1]):a[t]=[a[t],r[r.length-1]]:a[t]=r[r.length-1];break}var l=i[u+1];("object"==l||"array"==l)&&u<r.length-1?(a[t]||(a[t]={}),a=a[t]):a[t]=s().isImmutable(e.value.to)?e.value.to.toJS():e.value.to}})),n}(this.mergeLog[e.operation],e,[e.operation]));case"diff":return void this.log.push([e.operation,e.path,e.steps]);case"init":return void this.log.push([e.operation,e.value])}}},{key:"remove",value:function(e){for(var t in this.mergeLog)!1===e([""+t,this.mergeLog[t]])&&delete this.mergeLog[t];this.log=this.log.filter((function(t){return!1!==e(t)}))}},{key:"update",value:function(e){for(var t in this.mergeLog)!1===e(this.mergeLog[t])&&delete this.mergeLog[t];this.log=this.log.map((function(t){return e(t)||t}))}},{key:"getDiff",value:function(){return this.exportLog().filter((function(e){return"init"!=e[0]}))}},{key:"exportLog",value:function(){if(this.cache.length)return this.cache;var e=this.log.filter((function(e){return"init"!=e[0]}));return this.mergeLog.del&&e.unshift(["del",this.mergeLog.del]),this.mergeLog.add&&e.unshift(["add",this.mergeLog.add]),this.mergeLog.update&&e.unshift(["update",this.mergeLog.update]),e.unshift(this.log[0]),this.cache=e}},{key:"init",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];this.mergeLog={},this.cache=[],this.log=[],Array.isArray(e)&&(this.log=e)}}]),new F);function F(){D(this,F),q(this,"mergeLog",{}),q(this,"log",[]),q(this,"cache",[])}function H(){return JSON.stringify(this.map((function(e){return s().fromJS(e).toJS()})))}function N(e,t){if(!Array.isArray(e))throw new Error("请输入快照");var r;z.init(e);for(var n,o=[],i=0;i<e.length;i++)"init"==(n=e[i])[0]&&(o.push(r=[]),n=s().fromJS(n).toJS(),g(t)?J(t,n[1]):t=n[1],n[1]=t),Array.isArray(r)&&r.push(n);return o.map((function(e){var t,r;"object"==T(e[0][1])&&(t=e[0][1],r=t=s().isImmutable(t)?t.toJS():t,s().fromJS(e).toJS().map((function(e){return s().isImmutable(e)?e=s().toJS(e):s().isImmutable(e[1])&&(e[1]=s().toJS(e[1])),"add"==e[0]||"del"==e[0]||"update"==e[0]?function(e,t){if("object"!=E(e))throw new Error("请输入Object");return"add"==t[0]||"update"==t[0]?J(e,t[1]):("del"==t[0]&&function e(t,r,n){for(var o in n=n||s().List([]),t)"object"!=E(t[o])||Array.isArray(t[o])?Array.isArray(t[o])?t[o].forEach((function(e){return r(n.push(o).push(e))})):r(n.push(o).push(t[o])):t[o]?e(t[o],r,n.push(o)):r(n.push(o))}(t[1],(function(t){var r=e;t.map((function(e,n){n<(t.length||t.size)-1?r=r[e]:delete r[e]}))})),e)}(r,e):"diff"==e[0]?function(e,t){var r=1<arguments.length&&void 0!==t?t:[],n=0,o=(t=r[1],e);t.map((function(e){o=o[e]})),r[2].forEach((function(e){if("add"==e[0])o.splice.apply(o,[e[1]+n,0].concat(function(e){if(Array.isArray(e))return P(e)}(r=e.slice(2))||function(){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}()||function(e){if(e){if("string"==typeof e)return P(e,void 0);var t=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(t="Object"===t&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?P(e,void 0):void 0}}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())),n+=e.length-2;else if("del"==e[0])for(var t=1;t<e.length;t++)o.splice(e[t]+n,1),n--;else"update"==e[0]&&(o[e[1]+n]=e[2]);var r}))}(r,e):void 0})))})),t}function $(){D(this,$),q(this,"proto",null),z.init()}C($,[{key:"replay",value:function(e,t){return this.proto=N(e,t),this}},{key:"rollback",value:function(e,t){var r=this;return this.reverseLog(e,t).exportLog((function(e){r.replay(e,t)})),this}},{key:"reverseLog",value:function(e,t){if(!Array.isArray(e))throw new Error("请输入快照");var r,n;z.init(e),g(t)?J(t,N(e)):t=N(e);for(var o=0;o<e.length;o++)if("init"==(n=e[o])[0]){r=n[1];break}return V(t,r),this}},{key:"exportLog",value:function(e){var t=z.exportLog();return Object.getPrototypeOf(t).toString=H,"function"==typeof e&&e(t),this}}]),(c=$).prototype.getDiff=function(e){var t=z.getDiff();return Object.getPrototypeOf(t).toString=H,"function"==typeof e&&e(s().fromJS(t).toJS()),this},c.prototype.init=function(e){z.init(),z.push({operation:"init",value:e})},c.prototype.add=function(e){z.push(e)};var R=new c;function U(e,t,r){for(var n=2<arguments.length&&void 0!==r?r:function(e,t){return e===t},o=e.size,i=t.size,a={1:0},u={0:{1:0}},l=0;l<=o+i;l++){for(var f={},c=-l;c<=l;c+=2){for(var s=c==-l||c!=l&&a[c+1]>a[c-1],p=a[s?c+1:c-1],y=p=s?p:p+1,m=p-c;y<o&&m<i&&n(e.get(y),t.get(m));)y++,m++;if(a[c]=y,(f[c]=y)==o&&m==i)return u[l]=f,function(e,t,r){var n=[],o=0;e.forEach((function(e,i){var a=e[0],u=e[1],l=e[2],f=a;if(0===i&&0!==a)for(var c=0;c<a;c++)n.push({operation:"",value:t.get(c),index:[c,o]}),o++;u-a==1?(n.push({operation:"del",value:t.get(a),index:[a,o]}),f=u):(n.push({operation:"add",value:r.get(o),index:[a,o]}),o++);for(var s=0;s<l-f;s++)n.push({operation:"",value:t.get(f+s),index:[f+s,o]}),o++}));for(var i,a,u,l=[],f=0;f<n.length;f++)a=n[f],u=n[f+1],"del"==(null===(i=a)||void 0===i?void 0:i.operation)&&"add"==(null===(i=u)||void 0===i?void 0:i.operation)&&a.index[1]==u.index[1]?(l.push({operation:"update",value:u.value,index:a.index}),f++):l.push(a);return l}(function(e,t){for(var r=[],n={x:o,y:i};0<t;t--){var a=e[t],u=e[t-1],l=n.x-n.y,f=a[l],c=(a=(u=u[a=(c=l==-t||l!=t&&u[1+l]>u[l-1])?1+l:l-1])-a,c?u:u+1);r.unshift([u,c,f]),n.x=u,n.y=a}return r}(u,l),e,t)}u[l]=f}}var B=function(e,t){return v(e)||v(t)?e===t:s().isImmutable(e)&&s().isImmutable(t)?s().is(e,t):(s().isImmutable(e)&&(e=e.toJS()),s().isImmutable(t)&&(t=t.toJS()),l.unImmutableData.equal(e,t))};function G(e,t){var r,n,o,i,a,u,f,c,p,y,d,h,b=0,x=0;if(g(e)){if(e=s().fromJS(e),t=s().fromJS(t),S(e)==S(t)){var L=m.get(e,t);if(!L){if("Immutable Map"==S(e))return function(e,t){var r=0,n=0,o=0,i=0,a={};t.map((function(t,r){j(t)||(a[r]=t,j(e.get(r))&&n++)})),e.map((function(e,t){j(e)||(j(a[t])?g(e)?o+=O(e):o++:s().is(e,a[t])?i+=O(e):(t=G(e,a[t]),r+=t.update,o+=t.del,n+=t.add,i+=t.unchanged))}));var u={unchanged:i,add:n,del:o,update:r,similarity:Math.round(i/(n+o+r+i)*100)/100};return m.set(e,t,u),u}(e,t);if("Immutable List"==S(e))return y=p=c=f=0,d=U(r=e,n=t,(function(e,t){return v(e)||v(t)?e===t:"Immutable Map"==S(e)&&"Immutable Map"==S(t)&&e.get(l.list.key)&&t.get(l.list.key)?e.get(l.list.key)===t.get(l.list.key):G(e,t).similarity>=l.list.mapSimilarityForDiff})),h={unchanged:y+=(h=r,u=a=i=o=0,d.length?d.forEach((function(e){e.operation?"add"==e.operation?i++:"del"==e.operation?a+=O(e.value):"update"==e.operation&&(u+=O(e.value)):o+=O(e.value)})):o=O(h),h=Math.round(o/(i+a+u+o)*100)/100,(h={unchanged:o,add:i,del:a,update:u,similarity:h}).unchanged),add:c+=h.add,del:p+=h.del,update:f+=h.update,similarity:Math.round(y/(c+p+f+y)*100)/100},m.set(r,n,h),h}return L}b+=O(e)}else e===t?x+=1:b+=1;return x={unchanged:x,add:0,del:0,update:b,similarity:Math.round(x/(b+x)*100)/100},m.set(e,t,x),x}function K(e,t){return s().is(e,t)}function Q(e,t,r,n,o){if(g(e)&&g(t)){if(e=s().fromJS(e),t=s().fromJS(t),s().is(e,t))return;var i=S(e);if(i==S(t)){if("Immutable List"==i)return a=e,u=t,f=r,c=n.push(S(e,!0)),p=o,void((y=U(a,u,(function(e,t){return v(e)||v(t)?e===t:"Immutable Map"==S(e)&&"Immutable Map"==S(t)&&e.get(l.list.key)&&t.get(l.list.key)?e.get(l.list.key)===t.get(l.list.key):G(e,t).similarity>=l.list.mapSimilarityForDiff}))).length?(y.forEach((function(e){if(!(e.operation||"Immutable Map"!=S(e.value)&&"Immutable List"!=S(e.value)||K(a.get(e.index[0]),u.get(e.index[1]))))return p(a.get(e.index[0]),u.get(e.index[1]),f.push(e.index[0]),c,p)})),R.add({path:f,type:c,operation:"diff",steps:function(e){for(var t,r,n,o=[],i=0;i<e.length;i++)null!==(n=e[i])&&void 0!==n&&n.operation&&(r=[n.operation,n.index[0]],"add"==(null==n?void 0:n.operation)?("add"==(null===(t=o[o.length-1])||void 0===t?void 0:t[0])&&o[o.length-1][1]==n.index[0]?r=o[o.length-1]:o.push(r),r.push(n.value)):"del"==(null==n?void 0:n.operation)?"del"==(null===(t=o[o.length-1])||void 0===t?void 0:t[0])?(r=o[o.length-1]).push(n.index[0]):o.push(r):(r.push(n.value),o.push(r)));return o}(y)})):(a.length||a.size)&&a.map((function(e,t){if(!K(e,u.get(t)))return p(e,u.get(t),f.push(t),c,p)})));if("Immutable Map"==i)return m=e,d=t,h=r,b=n.push(S(e,!0)),O=o,d.map((function(e,t){j(e)||j(m.get(t))&&R.add({path:h.push(t),operation:"add",type:b,value:{from:void 0,to:x(d.get(t))}})})),void m.map((function(e,t){var r=d.get(t+="");if(!j(e)&&!B(e,r)){if(!j(r))return O(e,r,h.push(t),b,O);R.add({path:h.push(t),operation:"del",type:b.push(S(e,!0)),value:{from:x(e),to:void 0}})}}))}}var a,u,f,c,p,y,m,d,h,b,O;B(e,t)||R.add({path:r,type:n.push(S(e,!0)),operation:"update",value:{from:x(e),to:x(t)}})}function V(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return e=s().fromJS(e),R.init(e),l.set(r),Q(e,s().fromJS(t),s().List([]),s().List([]),Q),R.compare=V,R}function W(e){return(W="function"==typeof Symbol&&"symbol"==i(Symbol.iterator)?function(e){return i(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":i(e)})(e)}p=void 0,c=function(e){var t={compare:V,similarity:G,getDiff:R.getDiff,replay:R.replay,exportLog:R.exportLog,clearCache:m.clear};e.default=t,e.compare=V,e.similarity=G,e.getDiff=R.getDiff,e.replay=R.replay,e.exportLog=R.exportLog,e.clearCache=m.clear,e.reverseLog=R.reverseLog,e.rollback=R.rollback},"object"===W(t)?c(t):a.amdO?(n=[t],void 0===(o="function"==typeof(o=c)?o.apply(t,n):o)||(e.exports=o)):c((p="undefined"!=typeof globalThis?globalThis:p||self).TreeDiff={})}()},,e=>{"use strict";e.exports=require("immutable")},e=>{"use strict";e.exports=require("kind-of")},e=>{"use strict";e.exports=require("isobject")},(e,t,r)=>{"use strict";r.r(t),r.d(t,{diff:()=>function(e,t){var r=[];return n().compare(e,t).exportLog((function(e){r=e})),r}}),t=r(0);var n=r.n(t)}],t={};function r(n){var o=t[n];return void 0!==o||(o=t[n]={exports:{}},e[n](o,o.exports,r)),o.exports}r.amdO={},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{"use strict";r.r(n);var e,t,o=r(5);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e=void 0,t=function(e){var t={diff:o.diff};e.default=t,e.diff=o.diff},"object"===("undefined"==typeof exports?"undefined":i(exports))?t(exports):"function"==typeof define&&r.amdO?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).DataTimeLine={})})()})();